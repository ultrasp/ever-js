(()=>{"use strict";var t={219:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},510:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TvmException=e.Contract=void 0;const n=s(786),i=s(851);e.Contract=class{constructor(t,e,s){if(!Array.isArray(e.functions))throw new Error("Invalid abi. Functions array required");if(!Array.isArray(e.events))throw new Error("Invalid abi. Events array required");this._provider=t,this._abi=JSON.stringify(e),this._functions=e.functions.reduce(((t,e)=>(t[e.name]={inputs:e.inputs||[],outputs:e.outputs||[]},t)),{}),this._events=e.events.reduce(((t,e)=>(t[e.name]={inputs:e.inputs||[]},t)),{}),this._address=s,this._methods=new Proxy({},{get:(t,e)=>{const s=this._functions[e];return(t={})=>new a(this._provider,s,this._abi,this._address,e,t)}})}get methods(){return this._methods}get address(){return this._address}get abi(){return this._abi}transactions(t){return t.transactions(this._address).flatMap((({transactions:t})=>t))}events(t){return t.transactions(this._address).flatMap((({transactions:t})=>t)).flatMap((t=>this.decodeTransactionEvents({transaction:t}).then((e=>(e.forEach((e=>e.transaction=t)),e)))))}async waitForEvent(t={}){const{range:e,filter:s}=t,i="string"==typeof s?({event:t})=>t===s:s;let r=t.subscriber;const a=null==r;null==r&&(r=new this._provider.Subscriber);const o=await(null!=(null==e?void 0:e.fromLt)||null!=(null==e?void 0:e.fromUtime)?r.oldTransactions(this._address,e).merge(r.transactions(this._address)):r.transactions(this.address)).flatMap((t=>t.transactions)).takeWhile((t=>null==e||(null==e.fromLt||n.LT_COLLATOR.compare(t.id.lt,e.fromLt)>0)&&(null==e.fromUtime||t.createdAt>e.fromUtime)&&(null==e.toLt||n.LT_COLLATOR.compare(t.id.lt,e.toLt)<0)&&(null==e.toUtime||t.createdAt<e.toUtime))).flatMap((t=>this.decodeTransactionEvents({transaction:t}).then((e=>(e.forEach((e=>e.transaction=t)),e))))).filterMap((async t=>null==i||await i(t)?t:void 0)).first();return a&&await r.unsubscribe(),o}async getPastEvents(t){const{range:e,filter:s,limit:i}=t,r="string"==typeof s?({event:t})=>t===s:s,a=[];let o=null==t?void 0:t.continuation;t:for(;;){const{transactions:t,continuation:s}=await this._provider.getTransactions({address:this._address,continuation:o});if(null===t.length)break;const c=t.filter((t=>(null==(null==e?void 0:e.fromLt)||n.LT_COLLATOR.compare(t.id.lt,e.fromLt)>0)&&(null==(null==e?void 0:e.fromUtime)||t.createdAt>e.fromUtime)&&(null==(null==e?void 0:e.toLt)||n.LT_COLLATOR.compare(t.id.lt,e.toLt)<0)&&(null==(null==e?void 0:e.toUtime)||t.createdAt<e.toUtime)));if(c.length>0){const t=await Promise.all(c.map((async t=>({tx:t,events:await this.decodeTransactionEvents({transaction:t}).then((e=>(e.forEach((e=>e.transaction=t)),e)))}))));for(let{tx:e,events:s}of t){null!=r&&(s=await Promise.all(s.map((async t=>await r(t)?t:void 0))).then((t=>t.filter((t=>null!=t))))),o=e.id;for(const t of s){if(null!=i&&a.length>=i)break t;a.push(t)}if(null!=i&&a.length>=i)break t}}if(o=s,null==o)break}return{events:a,continuation:o}}async decodeTransaction(t){await this._provider.ensureInitialized();try{const e=await this._provider.rawApi.decodeTransaction({transaction:(0,i.serializeTransaction)(t.transaction),abi:this._abi,method:t.methods});if(null==e)return;const{method:s,input:n,output:r}=e,a=this._functions[s];return{method:s,input:null!=a.inputs?(0,i.parseTokensObject)(a.inputs,n):{},output:null!=a.outputs?(0,i.parseTokensObject)(a.outputs,r):{}}}catch(t){return}}async decodeTransactionEvents(t){await this._provider.ensureInitialized();try{const{events:e}=await this._provider.rawApi.decodeTransactionEvents({transaction:(0,i.serializeTransaction)(t.transaction),abi:this._abi}),s=[];for(const{event:t,data:n}of e){const e=this._events[t];s.push({event:t,data:null!=e.inputs?(0,i.parseTokensObject)(e.inputs,n):{}})}return s}catch(t){return[]}}async decodeInputMessage(t){await this._provider.ensureInitialized();try{const e=await this._provider.rawApi.decodeInput({abi:this._abi,body:t.body,internal:t.internal,method:t.methods});if(null==e)return;const{method:s,input:n}=e,r=this._functions[s];return{method:s,input:null!=r.inputs?(0,i.parseTokensObject)(r.inputs,n):{}}}catch(t){return}}async decodeOutputMessage(t){await this._provider.ensureInitialized();try{const e=await this._provider.rawApi.decodeOutput({abi:this._abi,body:t.body,method:t.methods});if(null==e)return;const{method:s,output:n}=e,r=this._functions[s];return{method:s,output:null!=r.outputs?(0,i.parseTokensObject)(r.outputs,n):{}}}catch(t){return}}async decodeEvent(t){await this._provider.ensureInitialized();try{const e=await this._provider.rawApi.decodeEvent({abi:this.abi,body:t.body,event:t.events});if(null==e)return;const{event:s,data:n}=e,r=this._events[s];return{event:s,data:null!=r.inputs?(0,i.parseTokensObject)(r.inputs,n):{}}}catch(t){return}}};class r extends Error{constructor(t){super(`TvmException: ${t}`),this.code=t}}e.TvmException=r;class a{constructor(t,e,s,n,r,a){this.provider=t,this.functionAbi=e,this.abi=s,this.address=n,this.method=r,this.params=(0,i.serializeTokensObject)(a)}async send(t){await this.provider.ensureInitialized();const{transaction:e}=await this.provider.rawApi.sendMessage({sender:t.from.toString(),recipient:this.address.toString(),amount:t.amount,bounce:null==t.bounce||t.bounce,payload:{abi:this.abi,method:this.method,params:this.params}});return(0,i.parseTransaction)(e)}async sendDelayed(t){await this.provider.ensureInitialized();const e=new n.DelayedTransactions,s=await this.provider.subscribe("messageStatusUpdated");s.on("data",(s=>{s.address.equals(t.from)&&e.fillTransaction(s.hash,s.transaction)}));const{message:i}=await this.provider.rawApi.sendMessageDelayed({sender:t.from.toString(),recipient:this.address.toString(),amount:t.amount,bounce:null==t.bounce||t.bounce,payload:{abi:this.abi,method:this.method,params:this.params}}).catch((t=>{throw s.unsubscribe().catch(console.error),t})),r=e.waitTransaction(this.address,i.hash).finally((()=>s.unsubscribe().catch(console.error)));return{messageHash:i.hash,expireAt:i.expireAt,transaction:r}}async sendWithResult(t){await this.provider.ensureInitialized();let e=t.subscriber;const s=null==e;null==e&&(e=new this.provider.Subscriber);try{let n,r;const a=new Promise((t=>{r=e=>t(e)})),o=[];e.transactions(this.address).flatMap((t=>t.transactions)).filter((e=>{var s;return(null===(s=e.inMessage.src)||void 0===s?void 0:s.equals(t.from))||!1})).on((t=>{null==n?o.push(t):n.possibleMessages.findIndex((e=>e.hash==t.inMessage.hash))>=0&&(null==r||r(t))}));const c=await this.send(t),u=c.outMessages.filter((t=>{var e;return(null===(e=t.dst)||void 0===e?void 0:e.equals(this.address))||!1}));n={transaction:c,possibleMessages:u};const d=o.find((t=>u.findIndex((e=>e.hash==t.inMessage.hash))>=0));null!=d&&(null==r||r(d));const l=await a;let h;try{const t=await this.provider.rawApi.decodeTransaction({transaction:(0,i.serializeTransaction)(l),abi:this.abi,method:this.method});null!=t&&(h=null!=this.functionAbi.outputs?(0,i.parseTokensObject)(this.functionAbi.outputs,t.output):{})}catch(t){console.error(t)}return{parentTransaction:n.transaction,childTransaction:l,output:h}}finally{s&&await e.unsubscribe()}}async estimateFees(t){await this.provider.ensureInitialized();const{fees:e}=await this.provider.rawApi.estimateFees({sender:t.from.toString(),recipient:this.address.toString(),amount:t.amount,payload:{abi:this.abi,method:this.method,params:this.params}});return e}async sendExternal(t){await this.provider.ensureInitialized();const e=!0===t.withoutSignature?this.provider.rawApi.sendUnsignedExternalMessage:this.provider.rawApi.sendExternalMessage,{transaction:s,output:n}=await e({publicKey:t.publicKey,recipient:this.address.toString(),stateInit:t.stateInit,payload:{abi:this.abi,method:this.method,params:this.params},local:t.local});return{transaction:(0,i.parseTransaction)(s),output:null!=n?(0,i.parseTokensObject)(this.functionAbi.outputs,n):void 0}}async sendExternalDelayed(t){await this.provider.ensureInitialized();const e=new n.DelayedTransactions,s=await this.provider.subscribe("messageStatusUpdated");s.on("data",(t=>{t.address.equals(this.address)&&e.fillTransaction(t.hash,t.transaction)}));const{message:i}=await this.provider.rawApi.sendExternalMessageDelayed({publicKey:t.publicKey,recipient:this.address.toString(),stateInit:t.stateInit,payload:{abi:this.abi,method:this.method,params:this.params}}).catch((t=>{throw s.unsubscribe().catch(console.error),t})),r=e.waitTransaction(this.address,i.hash).finally((()=>s.unsubscribe().catch(console.error)));return{messageHash:i.hash,expireAt:i.expireAt,transaction:r}}async call(t={}){await this.provider.ensureInitialized();const{output:e,code:s}=await this.provider.rawApi.runLocal({address:this.address.toString(),cachedState:t.cachedState,responsible:t.responsible,functionCall:{abi:this.abi,method:this.method,params:this.params}});if(null==e||0!=s)throw new r(s);return(0,i.parseTokensObject)(this.functionAbi.outputs,e)}async encodeInternal(){await this.provider.ensureInitialized();const{boc:t}=await this.provider.rawApi.encodeInternalInput({abi:this.abi,method:this.method,params:this.params});return t}}},511:function(t,e,s){var n=this&&this.__createBinding||(Object.create?function(t,e,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,n,i)}:function(t,e,s,n){void 0===n&&(n=s),t[n]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&n(e,t,s);return i(e,t),e},a=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||n(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.ProviderNotInitializedException=e.ProviderNotFoundException=e.ProviderRpcClient=e.hasEverscaleProvider=e.LT_COLLATOR=e.mergeTransactions=e.MessageExpiredException=e.AddressLiteral=e.Address=e.Subscriber=void 0;const o=s(851),c=s(786),u=r(s(25)),d=r(s(510));a(s(219),e),a(s(851),e),a(s(510),e);var l=s(25);Object.defineProperty(e,"Subscriber",{enumerable:!0,get:function(){return l.Subscriber}});var h=s(786);Object.defineProperty(e,"Address",{enumerable:!0,get:function(){return h.Address}}),Object.defineProperty(e,"AddressLiteral",{enumerable:!0,get:function(){return h.AddressLiteral}}),Object.defineProperty(e,"MessageExpiredException",{enumerable:!0,get:function(){return h.MessageExpiredException}}),Object.defineProperty(e,"mergeTransactions",{enumerable:!0,get:function(){return h.mergeTransactions}}),Object.defineProperty(e,"LT_COLLATOR",{enumerable:!0,get:function(){return h.LT_COLLATOR}});const p="undefined"!=typeof window&&void 0!==window.document;let b;b=p&&"complete"!==document.readyState?new Promise((t=>{window.addEventListener("load",(()=>{t()}))})):Promise.resolve();const f=()=>p?window.__ever||window.ton:void 0;async function m(){return!!p&&(await b,!0===window.__hasEverscaleProvider||!0===window.hasTonProvider)}e.hasEverscaleProvider=m,e.ProviderRpcClient=class{constructor(t={}){this._subscriptions={connected:new Map,disconnected:new Map,transactionsFound:new Map,contractStateChanged:new Map,messageStatusUpdated:new Map,networkChanged:new Map,permissionsChanged:new Map,loggedOut:new Map},this._contractSubscriptions=new Map,this._properties=t;const e=this;class s extends d.Contract{constructor(t,s){super(e,t,s)}}this.Contract=s;class n extends u.Subscriber{constructor(){super(e)}}this.Subscriber=n,this._api=new Proxy({},{get:(t,e)=>t=>{if(null!=this._provider)return this._provider.request({method:e,params:t});throw new g}}),!0===t.forceUseFallback?this._initializationPromise=null!=t.fallback?t.fallback().then((t=>{this._provider=t})):Promise.resolve():(this._provider=f(),null!=this._provider?this._initializationPromise=Promise.resolve():this._initializationPromise=m().then((t=>new Promise((e=>{if(!t)return e();if(this._provider=f(),null!=this._provider)e();else{const t=!0===window.__hasEverscaleProvider?"ever#initialized":"ton#initialized";window.addEventListener(t,(t=>{this._provider=f(),e()}))}})))).then((async()=>{null==this._provider&&null!=t.fallback&&(this._provider=await t.fallback())}))),this._initializationPromise.then((()=>{null!=this._provider&&this._registerEventHandlers(this._provider)}))}async hasProvider(){return null!=this._properties.fallback||m()}async ensureInitialized(){if(await this._initializationPromise,null==this._provider)throw new w}get isInitialized(){return null!=this._provider}get raw(){if(null!=this._provider)return this._provider;throw new g}get rawApi(){return this._api}createContract(t,e){return new this.Contract(t,e)}createSubscriber(){return new this.Subscriber}async requestPermissions(t){await this.ensureInitialized();const e=await this._api.requestPermissions({permissions:t.permissions});return(0,o.parsePermissions)(e)}async changeAccount(){await this.ensureInitialized(),await this._api.changeAccount()}async disconnect(){await this.ensureInitialized(),await this._api.disconnect()}async subscribe(t,e){class s{constructor(t,e){this._subscribe=t,this._unsubscribe=e,this._listeners={data:[],subscribed:[],unsubscribed:[]},this._subscribed=!1,this.subscribe=async()=>{if(!this._subscribed){this._subscribed=!0,await this._subscribe(this);for(const t of this._listeners.subscribed)t()}},this.unsubscribe=async()=>{if(this._subscribed){this._subscribed=!1,await this._unsubscribe();for(const t of this._listeners.unsubscribed)t()}}}on(t,e){return this._listeners[t].push(e),this}notify(t){for(const e of this._listeners.data)e(t)}}const n=this._subscriptions[t],i=(0,c.getUniqueId)();switch(t){case"connected":case"disconnected":case"messageStatusUpdated":case"networkChanged":case"permissionsChanged":case"loggedOut":{const t=new s((async t=>{n.has(i)||n.set(i,(e=>{t.notify(e)}))}),(async()=>{n.delete(i)}));return await t.subscribe(),t}case"transactionsFound":case"contractStateChanged":{if(null==e)throw new Error("Address must be specified for the subscription");await this.ensureInitialized();const r=e.address.toString(),a=new s((async e=>{if(n.has(i))return;n.set(i,(t=>{t.address.toString()===r&&e.notify(t)}));let s=this._contractSubscriptions.get(r);null==s&&(s=new Map,this._contractSubscriptions.set(r,s));const a={state:"contractStateChanged"===t,transactions:"transactionsFound"===t};s.set(i,a);const{total:o,withoutExcluded:c}=v(s.values(),a);try{o.transactions===c.transactions&&o.state===c.state||await this.rawApi.subscribe({address:r,subscriptions:o})}catch(t){throw n.delete(i),s.delete(i),t}}),(async()=>{n.delete(i);const t=this._contractSubscriptions.get(r);if(null==t)return;const e=t.get(i),{total:s,withoutExcluded:a}=v(t.values(),e);t.delete(i),a.transactions||a.state?s.transactions===a.transactions&&s.state===a.state||await this.rawApi.subscribe({address:r,subscriptions:a}):await this.rawApi.unsubscribe({address:r})}));return await a.subscribe(),a}default:throw new Error(`Unknown event ${t}`)}}async getProviderState(){await this.ensureInitialized();const t=await this._api.getProviderState();return{...t,permissions:(0,o.parsePermissions)(t.permissions)}}async getBalance(t){const{state:e}=await this.getFullContractState({address:t});return null==e?"0":null==e?void 0:e.balance}async getFullContractState(t){return await this.ensureInitialized(),await this._api.getFullContractState({address:t.address.toString()})}async getAccountsByCodeHash(t){await this.ensureInitialized();const{accounts:e,continuation:s}=await this._api.getAccountsByCodeHash({...t});return{accounts:e.map((t=>new c.Address(t))),continuation:s}}async getTransactions(t){await this.ensureInitialized();const{transactions:e,continuation:s,info:n}=await this._api.getTransactions({...t,address:t.address.toString()});return{transactions:e.map(o.parseTransaction),continuation:s,info:n}}async getTransaction(t){await this.ensureInitialized();const{transaction:e}=await this._api.getTransaction({...t});return{transaction:e?(0,o.parseTransaction)(e):void 0}}async getExpectedAddress(t,e){const{address:s}=await this.getStateInit(t,e);return s}async getStateInit(t,e){await this.ensureInitialized();const{address:s,stateInit:n}=await this._api.getExpectedAddress({abi:JSON.stringify(t),...e,initParams:(0,o.serializeTokensObject)(e.initParams)});return{address:new c.Address(s),stateInit:n}}async getBocHash(t){return await this.ensureInitialized(),await this._api.getBocHash({boc:t}).then((({hash:t})=>t))}async packIntoCell(t){return await this.ensureInitialized(),await this._api.packIntoCell({abiVersion:t.abiVersion,structure:t.structure,data:(0,o.serializeTokensObject)(t.data)})}async unpackFromCell(t){await this.ensureInitialized();const{data:e}=await this._api.unpackFromCell({...t,structure:t.structure});return{data:(0,o.parseTokensObject)(t.structure,e)}}async extractPublicKey(t){await this.ensureInitialized();const{publicKey:e}=await this._api.extractPublicKey({boc:t});return e}async codeToTvc(t){await this.ensureInitialized();const{tvc:e}=await this._api.codeToTvc({code:t});return e}async mergeTvc(t){return await this.ensureInitialized(),await this._api.mergeTvc(t)}async splitTvc(t){return await this.ensureInitialized(),await this._api.splitTvc({tvc:t})}async setCodeSalt(t){let e;if("string"==typeof t.salt)await this.ensureInitialized(),e=t.salt;else{const{boc:s}=await this.packIntoCell(t.salt);e=s}return await this._api.setCodeSalt({code:t.code,salt:e})}async getCodeSalt(t){await this.ensureInitialized();const{salt:e}=await this.rawApi.getCodeSalt({code:t.code});return e}async addAsset(t){let e;if(await this.ensureInitialized(),"tip3_token"!==t.type)throw new Error("Unknown asset type");return e={rootContract:t.params.rootContract.toString()},await this._api.addAsset({account:t.account.toString(),type:t.type,params:e})}async verifySignature(t){return await this.ensureInitialized(),await this._api.verifySignature(t)}async signData(t){return await this.ensureInitialized(),await this._api.signData(t)}async signDataRaw(t){return await this.ensureInitialized(),await this._api.signDataRaw(t)}async encryptData(t){await this.ensureInitialized();const{encryptedData:e}=await this._api.encryptData(t);return e}async decryptData(t){await this.ensureInitialized();const{data:e}=await this._api.decryptData({encryptedData:t});return e}async sendMessage(t){await this.ensureInitialized();const{transaction:e}=await this._api.sendMessage({sender:t.sender.toString(),recipient:t.recipient.toString(),amount:t.amount,bounce:t.bounce,payload:t.payload?{abi:t.payload.abi,method:t.payload.method,params:(0,o.serializeTokensObject)(t.payload.params)}:void 0});return{transaction:(0,o.parseTransaction)(e)}}async sendMessageDelayed(t){await this.ensureInitialized();const e=new c.DelayedTransactions,s=await this.subscribe("messageStatusUpdated");s.on("data",(s=>{s.address.equals(t.sender)&&e.fillTransaction(s.hash,s.transaction)}));const{message:n}=await this._api.sendMessageDelayed({sender:t.sender.toString(),recipient:t.recipient.toString(),amount:t.amount,bounce:t.bounce,payload:t.payload?{abi:t.payload.abi,method:t.payload.method,params:(0,o.serializeTokensObject)(t.payload.params)}:void 0}).catch((t=>{throw s.unsubscribe().catch(console.error),t})),i=e.waitTransaction(t.sender,n.hash).finally((()=>s.unsubscribe().catch(console.error)));return{messageHash:n.hash,expireAt:n.expireAt,transaction:i}}_registerEventHandlers(t){const e={connected:t=>t,disconnected:t=>t,transactionsFound:t=>({address:new c.Address(t.address),transactions:t.transactions.map(o.parseTransaction),info:t.info}),contractStateChanged:t=>({address:new c.Address(t.address),state:t.state}),messageStatusUpdated:t=>({address:new c.Address(t.address),hash:t.hash,transaction:null!=t.transaction?(0,o.parseTransaction)(t.transaction):void 0}),networkChanged:t=>t,permissionsChanged:t=>({permissions:(0,o.parsePermissions)(t.permissions)}),loggedOut:t=>t};for(const[s,n]of Object.entries(e))t.addListener(s,(t=>{const e=this._subscriptions[s],i=n(t);for(const t of e.values())t(i)}))}};class w extends Error{constructor(){super("Everscale provider was not found")}}e.ProviderNotFoundException=w;class g extends Error{constructor(){super("Everscale provider was not initialized yet")}}function v(t,e){const s={state:!1,transactions:!1},n=Object.assign({},s);for(const i of t){if(n.transactions&&n.state)break;s.state||(s.state=i.state),s.transactions||(s.transactions=i.transactions),i!==e&&(n.state||(n.state=i.state),n.transactions||(n.transactions=i.transactions))}return{total:s,withoutExcluded:n}}e.ProviderNotInitializedException=g},851:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseTokensObject=e.serializeTokensObject=e.parseAccountInteraction=e.parsePermissions=e.parseMessage=e.serializeMessage=e.parseTransaction=e.serializeTransaction=void 0;const n=s(786);function i(t){return{...t,src:t.src?t.src.toString():void 0,dst:t.dst?t.dst.toString():void 0}}function r(t){return{...t,src:t.src?new n.Address(t.src):void 0,dst:t.dst?new n.Address(t.dst):void 0}}function a(t){return{...t,address:new n.Address(t.address)}}function o(t){if(t instanceof n.Address)return t.toString();if(Array.isArray(t)){const e=[];for(const s of t)e.push(o(s));return e}if(null!=t&&"object"==typeof t){const e={};for(const[s,n]of Object.entries(t))e[s]=o(n);return e}return t}function c(t,e){if(t.type.startsWith("map")){let[s,n]=t.type.split(",");s=s.slice(4),n=n.slice(0,-1);const i=[];for(const[r,a]of e)i.push([c({name:"",type:s},r),c({name:"",type:n,components:t.components},a)]);return i}{const s=t.type.endsWith("[]"),i=!s&&t.type.startsWith("optional"),r=s?t.type.slice(0,-2):i?t.type.slice(9,-1):t.type;if(s){const s={name:t.name,type:r,components:t.components},n=[];for(const t of e)n.push(c(s,t));return n}if(i)return null==e?null:c({name:t.name,type:r,components:t.components},e);if("tuple"===r){const s={};if(null!=t.components)for(const n of t.components)s[n.name]=c(n,e[n.name]);return s}return"address"===r?new n.Address(e):e}}e.serializeTransaction=function(t){return{...t,inMessage:i(t.inMessage),outMessages:t.outMessages.map(i)}},e.parseTransaction=function(t){return{...t,inMessage:r(t.inMessage),outMessages:t.outMessages.map(r)}},e.serializeMessage=i,e.parseMessage=r,e.parsePermissions=function(t){return{...t,accountInteraction:t.accountInteraction?a(t.accountInteraction):void 0}},e.parseAccountInteraction=a,e.serializeTokensObject=function(t){return o(t)},e.parseTokensObject=function(t,e){const s={};for(const n of t)s[n.name]=c(n,e[n.name]);return s}},25:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Subscriber=void 0;const n=s(786);async function i(t,e){return e(t)}e.Subscriber=class{constructor(t){this.provider=t,this.subscriptions=new Map,this.scanners=new Map,this.unsubscribe=async()=>this._unsubscribe()}transactions(t){return this._addSubscription("transactionsFound",t,!1)}trace(t){const e=(0,n.getUniqueId)();return new r(((s,n)=>{const i=new o(this,{origin:t,onData:s,onEnd:t=>{this.scanners.delete(e),n(t)}});return this.scanners.set(e,i),i.start(),Promise.resolve()}),(async()=>{const t=this.scanners.get(e);null!=t&&(this.scanners.delete(e),await t.stop())}),i,!0)}oldTransactions(t,e){const s=(0,n.getUniqueId)();return new r(((n,i)=>{const r=new a(this.provider,{address:t,onData:n,onEnd:t=>{this.scanners.delete(s),i(t)},...e});return this.scanners.set(s,r),r.start(),Promise.resolve()}),(async()=>{const t=this.scanners.get(s);null!=t&&(this.scanners.delete(s),await t.stop())}),i,!0)}states(t){return this._addSubscription("contractStateChanged",t,!1)}async _unsubscribe(){const t=[];for(const e of this.subscriptions.values())for(const[s,n]of Object.entries(e))delete e[s],null!=n&&t.push(n.subscription.then((t=>t.unsubscribe())).catch((()=>{})));this.subscriptions.clear();for(const e of this.scanners.values())t.push(e.stop());this.scanners.clear(),await Promise.all(t)}_addSubscription(t,e,s){const a=e.toString(),o=e=>{const s=this.subscriptions.get(a);if(null==s)return;const n=s[t];if(null!=n){const i=n.handlers.get(e);if(null!=i){n.handlers.delete(e);const{queue:t,onEnd:s,state:r}=i;r.finished||(r.finished=!0,t.clear(),t.enqueue((async()=>s(r.eof))))}if(0===n.handlers.size){const e=n.subscription;delete s[t],e.then((t=>t.unsubscribe())).catch(console.debug)}}null==s.contractStateChanged&&null==s.transactionsFound&&this.subscriptions.delete(a)},u=(0,n.getUniqueId)();return new r(((s,n)=>{const i=this.subscriptions.get(a);let r=null==i?void 0:i[t];const d={onData:s,onEnd:n,queue:new c,state:{eof:!1,finished:!1}};if(null!=r)return r.handlers.set(u,d),Promise.resolve();const l=new Map;l.set(u,d);const h=this.provider.subscribe(t,{address:e}).then((t=>(t.on("data",(t=>{for(const{onData:e,queue:s,state:n}of l.values())n.eof||n.finished||s.enqueue((async()=>{await e(t)||(n.eof=!0,o(u))}))})),t.on("unsubscribed",(()=>{for(const t of l.keys())o(t)})),t))).catch((t=>{console.error(t);for(const t of l.keys())o(t);throw t}));return r={subscription:h,handlers:l},null==i?this.subscriptions.set(a,{[t]:r}):i[t]=r,h.then((()=>{}))}),(()=>o(u)),i,s)}};class r{constructor(t,e,s,n){this.makeProducer=t,this.stopProducer=e,this.extractor=s,this.isFinite=n,this.fold=this.onlyFinite(((t,e,s)=>{let n=t;return new Promise(((t,i)=>{const r=this.makeProducer((t=>this.extractor(t,(async t=>(n=await e(n,t),!0)))),(e=>{e?t(n):i(new Error("Subscription closed"))}));null!=s&&(s.subscribed=r)}))})),this.finished=this.onlyFinite((t=>new Promise(((e,s)=>{const n=this.makeProducer((t=>this.extractor(t,(t=>!0))),(t=>{t?e(void 0):s(new Error("Subscription closed"))}));null!=t&&(t.subscribed=n)}))))}async delayed(t){const{subscribed:e,result:s}=t({first:()=>{const t={},e=this.first(t);return{subscribed:t.subscribed,result:e}},on:t=>{const e={};return this.on(t,e),{subscribed:e.subscribed,result:void 0}},fold:null!=this.fold?(t,e)=>{const s={},n=this.fold(t,e,s);return{subscribed:s.subscribed,result:n}}:void 0,finished:null!=this.finished?()=>{const t={},e=this.finished(t);return{subscribed:t.subscribed,result:e}}:void 0});return await e,()=>s}first(t){const e={found:!1};return new Promise(((s,n)=>{const i=this.makeProducer((t=>this.extractor(t,(t=>(Object.assign(e,{found:!0,result:t}),!1)))),(t=>{t?this.isFinite?s(e.found?e.result:void 0):e.found?s(e.result):n(new Error("Unexpected end of stream")):n(new Error("Subscription closed"))}));null!=t&&(t.subscribed=i)}))}on(t,e){const s=this.makeProducer((e=>this.extractor(e,(async e=>(await t(e),!0)))),(t=>{}));null!=e&&(e.subscribed=s)}merge(t){return new r(((e,s)=>{const n={stopped:!1,counter:0},i=t=>{n.stopped||2!=++n.counter&&t||(n.stopped=!0,s(t))};return Promise.all([this.makeProducer(e,i),t.makeProducer(e,i)]).then((()=>{}))}),(()=>{this.stopProducer(),t.stopProducer()}),this.extractor,this.isFinite&&t.isFinite)}enumerate(){const t={index:0};return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>s({index:t.index++,item:e})))),this.isFinite)}tap(t){return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>(await t(e),s(e))))),this.isFinite)}filter(t){return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>!await t(e)||s(e)))),this.isFinite)}filterMap(t){return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>{const n=await t(e);return void 0===n||s(n)}))),this.isFinite)}map(t){return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>{const n=await t(e);return s(n)}))),this.isFinite)}flatMap(t){return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>{const n=await t(e);for(const t of n)if(!await s(t))return!1;return!0}))),this.isFinite)}skip(t){const e={index:0};return new r(this.makeProducer,this.stopProducer,((s,n)=>this.extractor(s,(s=>e.index>=t?n(s):(++e.index,!0)))),this.isFinite)}skipWhile(t){const e={shouldSkip:!0};return new r(this.makeProducer,this.stopProducer,((s,n)=>this.extractor(s,(async s=>!(!e.shouldSkip||!await t(s))||(e.shouldSkip=!1,n(s))))),this.isFinite)}take(t){const e={index:0};return new r(this.makeProducer,this.stopProducer,((s,n)=>this.extractor(s,(s=>e.index<t&&(++e.index,n(s))))),!0)}takeWhile(t){return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>!!await t(e)&&s(e)))),!0)}takeWhileMap(t){return new r(this.makeProducer,this.stopProducer,((e,s)=>this.extractor(e,(async e=>{const n=await t(e);return void 0!==n&&s(n)}))),!0)}onlyFinite(t){return this.isFinite?t:void 0}}class a{constructor(t,e){this.provider=t,this.params=e,this.queue=new c,this.isRunning=!1}start(){this.isRunning||null!=this.promise||(this.isRunning=!0,this.promise=(async()=>{const t=this.params,e={complete:!1};for(;this.isRunning&&!e.complete;)try{const{transactions:s,continuation:i}=await this.provider.getTransactions({address:this.params.address,continuation:this.continuation});if(e.complete=!e.complete&&null==s.length,!this.isRunning||e.complete)break;const r=s.filter((e=>(null==t.fromLt||n.LT_COLLATOR.compare(e.id.lt,t.fromLt)>0)&&(null==t.fromUtime||e.createdAt>t.fromUtime)));if(0==r.length){e.complete=!0;break}const a={maxLt:r[0].id.lt,minLt:r[r.length-1].id.lt,batchType:"old"};if(this.queue.enqueue((async()=>{this.params.onData({address:this.params.address,transactions:r,info:a})||(e.complete=!0,this.isRunning=!1)})),null==i){e.complete=!0;break}this.continuation=i}catch(t){console.error(t)}this.queue.enqueue((async()=>this.params.onEnd(e.complete))),this.isRunning=!1,this.continuation=void 0})())}async stop(){this.isRunning=!1,this.queue.clear(),null!=this.promise?await this.promise:this.params.onEnd(!1)}}class o{constructor(t,e){this.subscriber=t,this.params=e,this.queue=new c,this.isRunning=!1,this.streams=new Map,this.pendingTransactions=new Map}start(){if(this.isRunning||null!=this.promise)return;const t=this.subscriber;this.isRunning=!0,this.promise=(async()=>{const e={complete:!1},s=this.params.origin.id.lt,n=e=>{for(const n of e.outMessages){if(null==n.dst)continue;const e=n.dst.toString();if(this.streams.has(e))continue;const i=t.oldTransactions(n.dst,{fromLt:s}).merge(t.transactions(n.dst)).flatMap((({address:t,transactions:e})=>e.map((e=>(e.account=t,e)))));this.streams.set(e,i),i.on((t=>{const e=t.inMessage.hash,s=this.pendingTransactions.get(e);null==s?this.pendingTransactions.set(e,{promise:Promise.resolve(t),resolve:()=>{},reject:()=>{}}):s.resolve(t)}))}},i=[this.params.origin];try{t:for(;this.isRunning;){const t=i.shift();if(null==t){e.complete=!0;break}n(t);for(const s of t.outMessages){if(null==s.dst)continue;const t=this.pendingTransactions.get(s.hash);let n;if(null==t){let t,e;const i=new Promise(((s,n)=>{t=t=>s(t),e=()=>n()}));this.pendingTransactions.set(s.hash,{promise:i,resolve:t,reject:e}),n=i}else n=t.promise;const r=await n;if(!this.isRunning||e.complete)break t;this.queue.enqueue((async()=>{this.params.onData(r)||(e.complete=!0,this.isRunning=!1,this.rejectPendingTransactions())})),i.push(r)}}}catch(t){}finally{this.queue.enqueue((async()=>this.params.onEnd(e.complete))),this.isRunning=!1;for(const t of this.streams.values())t.stopProducer()}})()}async stop(){this.isRunning=!1,this.queue.clear(),this.rejectPendingTransactions(),null!=this.promise?await this.promise:this.params.onEnd(!1)}rejectPendingTransactions(){for(const t of this.pendingTransactions.values())t.reject()}}class c{constructor(){this.queue=[],this.workingOnPromise=!1}enqueue(t){this.queue.push(t),this._dequeue().catch((()=>{}))}clear(){this.queue.length=0}async _dequeue(){if(this.workingOnPromise)return;const t=this.queue.shift();t&&(this.workingOnPromise=!0,t().then((()=>{this.workingOnPromise=!1,this._dequeue()})).catch((()=>{this.workingOnPromise=!1,this._dequeue()})))}}},786:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getUniqueId=e.mergeTransactions=e.LT_COLLATOR=e.DelayedTransactions=e.MessageExpiredException=e.AddressLiteral=e.Address=void 0;class s{constructor(t){this.equals=t=>this._equals(t),this._address=t}toString(){return this._address}toJSON(){return this._address}_equals(t){return t instanceof s?this._address===t._address:this._address===t}}e.Address=s,e.AddressLiteral=class extends s{constructor(t){super(t)}};class n extends Error{constructor(t,e){super("Message expired"),this.address=t,this.hash=e}}e.MessageExpiredException=n,e.DelayedTransactions=class{constructor(){this.transactions=new Map}async waitTransaction(t,e){var s;let i=null===(s=this.transactions.get(e))||void 0===s?void 0:s.promise;if(null==i){let t,s;i=new Promise(((e,n)=>{t=t=>e(t),s=()=>n()})),this.transactions.set(e,{promise:i,resolve:t,reject:s})}const r=await i;if(null==r)throw new n(t,e);return r}fillTransaction(t,e){const s=this.transactions.get(t);null!=s?s.resolve(e):this.transactions.set(t,{promise:Promise.resolve(e),resolve:()=>{},reject:()=>{}})}},e.LT_COLLATOR=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),e.mergeTransactions=function(t,s,n){if("old"===n.batchType)return t.push(...s),t;if(0===t.length)return t.push(...s),t;let i=0;for(;i<t.length&&e.LT_COLLATOR.compare(t[i].id.lt,n.maxLt)>=0;)++i;return t.splice(i,0,...s),t};const i=4294967295;let r=Math.floor(Math.random()*i);e.getUniqueId=function(){return r=(r+1)%i,r}}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,s),r.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t=s(511);const e={ever:function(){return new t.ProviderRpcClient},isConnected:async function(){const t=this.ever();let e=!1;if(await t.hasProvider())try{await t.ensureInitialized(),e=!0}catch(t){}return e},connectInfo:{hasError:!0,errorMessage:"",address:null},connect:async function(){const t=this.ever();if(!await t.hasProvider())return this.connectInfo.errorMessage="Extension Ever is not installed",this.connectInfo;const{accountInteraction:e}=await t.requestPermissions({permissions:["basic","accountInteraction"]});return null==e?(this.connectInfo.errorMessage="Insufficient permissions",this.connectInfo):(this.connectInfo.hasError=!1,this.connectInfo.address=e.address.toString(),this.connectInfo)},onConnect:async function(){await this.connect(),this.connectInfo.hasError?document.getElementById("Error").innerHTML=this.connectInfo.errorMessage:document.getElementById("Address").innerHTML=this.connectInfo.address},getBalance:async function(){const t=this.ever();if(this.connectInfo.hasError)return 0;const{state:e}=await t.getFullContractState({address:this.connectInfo.address});let s=e?parseFloat(utils.formatUnits(e.balance)):0;alert("Balance: "+s)}};document.getElementById("connect").addEventListener("click",(()=>e.onConnect())),document.getElementById("getBalance").addEventListener("click",(()=>e.getBalance()))})()})();